name: Build gbs-control firmware

on:
  push:
    branches: [ "*" ]
  pull_request:
    branches: [ "*" ]

jobs:

  containerbuild:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag jeffbrl/gbsc-builder:${{ github.sha }}

  listimages:

    runs-on: ubuntu-latest
    needs: [ containerbuild ]
    steps:
    - uses: actions/checkout@v4
    - name: List images
      run: docker images

  firmwarebuild:

    runs-on: ubuntu-latest
    needs: [ containerbuild, listimages ]
    steps:
    - uses: actions/checkout@v4
    - name: Build gbsc firmware
      run: docker run -v /tmp:/app/output jeffbrl/gbsc-builder:${{ github.sha }}

